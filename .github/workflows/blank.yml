name: 5-Parallel-RDP-VBox-Downloader

on: 
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-2022
    # Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù„ØªØ´ØºÙŠÙ„ 5 Ø¬ÙˆØ¨ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª
    strategy:
      fail-fast: false
      max-parallel: 5
      matrix:
        include:
          # Ø§Ù„Ø¬ÙˆØ¨ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£ÙˆÙ„ + Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
          - id: 1
            url: "https://huggingface.co/datasets/hiodas94/rdp/resolve/main/win.zip"
          # Ø§Ù„Ø¬ÙˆØ¨ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø«Ø§Ù†ÙŠ + CRD_CODE1
          - id: 2
            url: "https://huggingface.co/datasets/swelam100/rdp/resolve/main/win.zip"
          # Ø§Ù„Ø¬ÙˆØ¨ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø«Ø§Ù„Ø« + CRD_CODE2
          - id: 3
            url: "https://huggingface.co/datasets/gfdg34fsd/rdp/resolve/main/win.zip"
          # Ø§Ù„Ø¬ÙˆØ¨ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø±Ø§Ø¨Ø¹ + CRD_CODE3
          - id: 4
            url: "https://huggingface.co/datasets/sjkhfuk/rdp/resolve/main/win.zip"
          # Ø§Ù„Ø¬ÙˆØ¨ Ø§Ù„Ø®Ø§Ù…Ø³: Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ù…Ø³ + CRD_CODE4
          - id: 5
            url: "https://huggingface.co/datasets/swe1000/rdp/resolve/main/win.zip"

    steps:
      # -----------------------------------------------------------
      # Ø®Ø·ÙˆØ© 1: ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª (Chrome, CRD, VirtualBox)
      # -----------------------------------------------------------
      - name: Install Prerequisites
        shell: pwsh
        run: |
          Write-Host "â¬‡ï¸ Downloading Chrome..."
          Invoke-WebRequest -Uri "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -OutFile "chrome_installer.exe"
          Start-Process -FilePath "chrome_installer.exe" -Args "/silent /install" -Wait
          
          Write-Host "â¬‡ï¸ Downloading CRD Host..."
          Invoke-WebRequest -Uri "https://dl.google.com/edgedl/chrome-remote-desktop/chromeremotedesktophost.msi" -OutFile "crd.msi"
          Start-Process -FilePath "msiexec.exe" -Args "/i crd.msi /quiet /qn" -Wait

          Write-Host "â¬‡ï¸ Downloading VirtualBox..."
          $vboxUrl = "https://download.virtualbox.org/virtualbox/6.1.48/VirtualBox-6.1.48-159471-Win.exe"
          (New-Object System.Net.WebClient).DownloadFile($vboxUrl, "VirtualBox-Setup.exe")
          Start-Process -FilePath "VirtualBox-Setup.exe" -Args "--silent --ignore-reboot" -Wait
          Write-Host "âœ… All Software Installed Successfully."

      # -----------------------------------------------------------
      # Ø®Ø·ÙˆØ© 2: Ø§Ø®ØªÙŠØ§Ø± ÙƒÙˆØ¯ CRD Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„
      # -----------------------------------------------------------
      - name: Select Code and Start CRD
        shell: pwsh
        env:
          # ØªÙ…Ø±ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© ÙƒÙ…ØªØºÙŠØ±Ø§Øª Ø¨ÙŠØ¦Ø©
          MAIN_CODE: ${{ secrets.CRD_CODE }}
          CODE_1: ${{ secrets.CRD_CODE1 }}
          CODE_2: ${{ secrets.CRD_CODE2 }}
          CODE_3: ${{ secrets.CRD_CODE3 }}
          CODE_4: ${{ secrets.CRD_CODE4 }}
          PIN: ${{ secrets.CRD_PIN }}
          JOB_ID: ${{ matrix.id }}
        run: |
          # Ù…Ù†Ø·Ù‚ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ¨
          if ($env:JOB_ID -eq 1) { $SelectedCode = $env:MAIN_CODE }
          elseif ($env:JOB_ID -eq 2) { $SelectedCode = $env:CODE_1 }
          elseif ($env:JOB_ID -eq 3) { $SelectedCode = $env:CODE_2 }
          elseif ($env:JOB_ID -eq 4) { $SelectedCode = $env:CODE_3 }
          elseif ($env:JOB_ID -eq 5) { $SelectedCode = $env:CODE_4 }
          else { Write-Error "Invalid Job ID"; exit 1 }

          if (-not $SelectedCode) { Write-Error "âŒ Code not found for Job $env:JOB_ID. Check your Secrets."; exit 1 }

          $exePath = "${Env:PROGRAMFILES(X86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe"
          $UniqueName = "${{ github.actor }}-Machine-${env:JOB_ID}"
          
          Write-Host "ğŸš€ STARTING RDP SERVICE: $UniqueName using Code for Job $env:JOB_ID"
          & $exePath --code="$SelectedCode" --redirect-url="https://remotedesktop.google.com/_/oauthredirect" --name="$UniqueName" --pin=$env:PIN

      # -----------------------------------------------------------
      # Ø®Ø·ÙˆØ© 3: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø¬ÙˆØ¨ ÙˆÙÙƒ Ø§Ù„Ø¶ØºØ·
      # -----------------------------------------------------------
      - name: Download and Extract Large File
        shell: cmd
        run: |
          @echo off
          cd /d "%USERPROFILE%\Desktop"
          
          :: Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† Ø§Ù„Ù…Ø§ØªØ±ÙŠÙƒØ³
          set "FILE_URL=${{ matrix.url }}"
          
          echo â¬‡ï¸ Downloading file for Machine ${{ matrix.id }}...
          curl -L -o BigFile.zip "%FILE_URL%"
          
          echo ğŸ“¦ Extracting files...
          7z x BigFile.zip -y
          
          del BigFile.zip
          echo âœ… Download and Extraction Complete.

      # -----------------------------------------------------------
      # Ø®Ø·ÙˆØ© 4: ØªØ´ØºÙŠÙ„ ÙˆØ§Ø¬Ù‡Ø© ÙÙŠØ±ØªÙˆØ§Ù„ Ø¨ÙˆÙƒØ³ (Ø¨Ø¯ÙˆÙ† ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù…)
      # -----------------------------------------------------------
      - name: Launch VirtualBox GUI
        shell: pwsh
        run: |
           # ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø· Ù„ØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
           $vboxGui = "$env:ProgramFiles\Oracle\VirtualBox\VirtualBox.exe"
           if (Test-Path $vboxGui) {
               Start-Process -FilePath $vboxGui
               Write-Host "âœ… VirtualBox GUI Started."
           }

      # -----------------------------------------------------------
      # Ø®Ø·ÙˆØ© 5: Ø§Ù„Ø¨Ù‚Ø§Ø¡ (Keep Alive)
      # -----------------------------------------------------------
      - name: Keep Alive
        shell: pwsh
        run: |
          Write-Host "âœ… System Ready. Login via Chrome Remote Desktop."
          while ($true) { Start-Sleep -Seconds 300 }
